<html>
    <head>
    <!-- Load c3.css -->
    <link href="/static/c3-0.4.10/c3.css" rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css">

    <!-- Load d3.js and c3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="/static/c3-0.4.10/c3.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
    </head>
    <body>
        <div class="content">
            <div class='col-md-6'>
                <h3 class='title'>Topics</h3>
                <table id="topic-table" class="table table-responsive table-boardered table-striped table-condensed">
                    <thead>
                        <th>Topics</th>
                    </thead>
                    <tbody> </tbody>
                </table>
            </div>
            <div class='chart col-md-6'>
                <h3 class='title'>Pie Chart</h3>
                <div id='chart'></div>
            </div>
        </div>
        <script type="text/javascript">
        $(document).ready(function(){
            var topics = {};

            $.getJSON("topics.json", function(doc_topics) {
                console.log(doc_topics); // this will show the info it in firebug console
                topics = doc_topics; 
                render_topics();
                render_pie_chart('topic0');
            });
           
            function render_pie_chart(topic_no) {
                console.log("loading ", topic_no);
                var chart = c3.generate({
                    data: {
                        // iris data from R
                        columns: topics[topic_no],
                        type : 'pie',
                        onclick: function (d, i) { console.log("onclick", d, i); },
                        //onmouseover: function (d, i) { console.log("onmouseover", d, i); },
                        //onmouseout: function (d, i) { console.log("onmouseout", d, i); }
                    }
                });
            }

            function render_topics() {
                var table_body = "";
                $.each(topics, function(k, v){
                   table_body += "<tr id=" + k + " class='topic'><td>";
                   v.forEach(function(item) {table_body+="<b>" + item[0] + "</b> <small>(" + item[1] + ") </small>"});

                   table_body += "</td></tr>";
                });
                $("#topic-table tbody").html(table_body);
                register_topic_pie_chart();
            }

            function register_topic_pie_chart() {
                $(".topic").hover(function(){
                    var topic_id = $(this).attr("id"); 
                    console.log(topic_id);
                    render_pie_chart(topic_id);
                });
            }

        });
        </script>
    </body>
</html>
